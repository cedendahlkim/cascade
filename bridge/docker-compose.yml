# Weaviate Vector Database for Cascade Remote
# Start with: docker compose up -d
# Then pull embedding model: docker compose exec ollama-embed ollama pull nomic-embed-text

services:
  weaviate:
    image: cr.weaviate.io/semitechnologies/weaviate:1.35.7
    ports:
      - "8080:8080"
      - "50051:50051"
    volumes:
      - weaviate_data:/var/lib/weaviate
    restart: on-failure:3
    environment:
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: "true"
      PERSISTENCE_DATA_PATH: "/var/lib/weaviate"
      ENABLE_MODULES: "text2vec-ollama"
      CLUSTER_HOSTNAME: "node1"
      OLLAMA_API_ENDPOINT: "http://ollama-embed:11434"
    depends_on:
      - ollama-embed

  ollama-embed:
    image: ollama/ollama:latest
    ports:
      - "11435:11434"
    volumes:
      - ollama_embed_data:/root/.ollama
    restart: on-failure:3

volumes:
  weaviate_data:
  ollama_embed_data:
